{"clips":["git remote add origin git@github.com:LukaHietala/hauva.git\ngit branch -M main\ngit push -u origin main","62892","\u003cmeta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"\u003e\u003cimg src=\"https://images.dog.ceo/breeds/labrador/n02099712_7414.jpg\"\u003e","const clipFile = \"koirankoppi.json\"","checks","package main","kill -USR1 $(pgrep clip)","package main\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"os\"\n\t\"os/exec\"\n\t\"os/signal\"\n\t\"strings\"\n\t\"syscall\"\n\t\"time\"\n)\n\nconst clipFile = \"koirankoppi.json\"\n\ntype ClipManager struct {\n\tClips []string `json:\"clips\"`\n}\n\n// loads all clips from json store (koirankoppi)\nfunc (cm *ClipManager) Load() error {\n\tfile, err := os.Open(clipFile)\n\tif err != nil {\n\t\tif os.IsNotExist(err) {\n\t\t\tcm.Clips = []string{}\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\tdefer file.Close()\n\treturn json.NewDecoder(file).Decode(cm)\n}\n\nfunc (cm *ClipManager) Save() error {\n\tfile, err := os.Create(clipFile)\n\tif err != nil {\n\t\treturn err\n\t}\n\tdefer file.Close()\n\treturn json.NewEncoder(file).Encode(cm)\n}\n\nfunc checkRequiredPrograms() {\n\t// just wayland app for now, maybe X11 in the future\n\t// maybe wofi, rofi, etc too? now just dmenu because its the most common\n\trequired := []string{\"wl-paste\", \"wl-copy\", \"dmenu\"}\n\tfor _, prog := range required {\n\t\tif _, err := exec.LookPath(prog); err != nil {\n\t\t\tfmt.Printf(\"%s not found : %v\\n\", prog, err)\n\t\t\tos.Exit(1)\n\t\t}\n\t}\n}\n\nfunc getClipboard() (string, error) {\n\tcmd := exec.Command(\"wl-paste\")\n\tout, err := cmd.Output()\n\treturn strings.TrimSpace(string(out)), err\n}\n\nfunc setClipboard(text string) error {\n\tcmd := exec.Command(\"wl-copy\")\n\tcmd.Stdin = strings.NewReader(text)\n\treturn cmd.Run()\n}\n\nfunc addClip() {\n\tcm := \u0026ClipManager{}\n\tcm.Load()\n\tclip, err := getClipboard()\n\tif err != nil {\n\t\tfmt.Println(\"error getting clipboard\", err)\n\t\treturn\n\t}\n\t// prevent duplicates, if one already exist then move it first\n\tfor i, c := range cm.Clips {\n\t\tif c == clip {\n\t\t\tcm.Clips = append(cm.Clips[:i], cm.Clips[i+1:]...)\n\t\t\tbreak\n\t\t}\n\t}\n\tcm.Clips = append([]string{clip}, cm.Clips...)\n\t// limit to 25, TODO: make optional\n\tif len(cm.Clips) \u003e 0 {\n\t\tcm.Clips = cm.Clips[:25]\n\t}\n\tcm.Save()\n}\n\nfunc selectClip() {\n\tcm := \u0026ClipManager{}\n\tcm.Load()\n\tif len(cm.Clips) == 0 {\n\t\tfmt.Println(\"no clips\")\n\t\treturn\n\t}\n\t// dmenu seperates options by \\n so prepare the clips\n\t// -i match insensitively, -l list vertically with number of lines, -p message/prompt\n\tinput := strings.Join(cm.Clips, \"\\n\")\n\tcmd := exec.Command(\"dmenu\", \"-i\", \"-l\", \"10\", \"-p\", \"Select clip:\")\n\t// pass stdin to dmenu to intrepret\n\tcmd.Stdin = strings.NewReader(input)\n\t// dmenu returns selected item as stdout\n\tout, err := cmd.Output()\n\tif err != nil {\n\t\tfmt.Println(\"dmenu error:\", err)\n\t\treturn\n\t}\n\tselected := strings.TrimSpace(string(out))\n\tsetClipboard(selected)\n}\n\nfunc main() {\n\t// wl-copy, wl-paste, dmenu\n\tcheckRequiredPrograms()\n\t// prevent same stuff being spammed to cm, \n\tlastClip := \"\"\n\t// check wl-paste every one second\n\tticker := time.NewTicker(time.Second)\n\tdefer ticker.Stop()\n\tsigChan := make(chan os.Signal, 1)\n\t// when receving signal from usr1, open clipboard menu :D\n\t// kill -USR1 $(pgrep hauva)\n\tsignal.Notify(sigChan, syscall.SIGUSR1)\n\tfor {\n\t\tselect {\n\t\tcase \u003c-ticker.C:\n\t\t\tclip, err := getClipboard()\n\t\t\tif err != nil {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tif clip != lastClip \u0026\u0026 clip != \"\" {\n\t\t\t\tlastClip = clip\n\t\t\t\taddClip()\n\t\t\t}\n\t\tcase \u003c-sigChan:\n\t\t\tfmt.Println(\"signal received, opening menu\")\n\t\t\tselectClip()\n\t\t}\n\t}\n}"]}
